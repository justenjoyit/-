# 数据库锁

> https://www.cnblogs.com/ismallboy/p/5574006.html

## 一、出现原因

解决并发出现的问题

## 二、并发控制

### 1、乐观锁

认为一个用户读数据的时候，别人不会去写自己所读的数据。

不做控制。乐观锁是在我们系统中实现的。

### 2、悲观锁

认为自己读数据的时候，别人可能正好在写自己读的数据。

所以在读取数据的时候，为了不让别人修改自己读取的数据，就会先对自己读取的数据加锁，只有自己把数据读完，才允许别人修改那部分数据。

（1）排它锁（写锁）

（2）共享锁（读锁）

### 3、时间戳

不加锁，通过时间戳来控制并发出现的问题。

在数据库表中单独加一列时间戳，每次读出来的时候，把该字段页读出来，当写回去的时候，把该字段加1，提交之前，跟数据库的该字段比较一次，如果比数据库的值大的话，就允许保存，否则不允许保存。



行级锁：一种排它锁，防止其他事务修改此行

表级锁：

（1）行共享：禁止排它锁定表

（2）行排他：禁止使用排它锁和共享锁

（3）共享锁：锁定表，对记录只读不写，多个用户可以同时在同一个表上应用此锁

（4）共享行排他：比共享锁更多的限制，禁止使用共享锁及更高的锁

（5）排他：限制最强的表锁，仅允许其他用户查询该表的行。禁止修改和锁定表